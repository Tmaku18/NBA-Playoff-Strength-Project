## Per-game prediction defaults (player next-game projections)
##
## This config is intentionally separate from `config/defaults.yaml` so the existing
## team-strength pipeline remains unchanged.
##
## MVP scope:
## - Use the same raw/DB locations by default
## - Train per-player, per-game regressors (PTS/REB/AST) with recency weighting
## - Use nba_api to resolve next-game schedule via PlayerNextNGames

# Season boundaries (hard-coded to avoid play-in ambiguity; used for filtering and date->season mapping)
seasons:
  "2015-16": { start: "2015-10-01", end: "2016-04-15" }
  "2016-17": { start: "2016-10-01", end: "2017-04-15" }
  "2017-18": { start: "2017-10-01", end: "2018-04-15" }
  "2018-19": { start: "2018-10-01", end: "2019-04-15" }
  "2019-20": { start: "2019-10-01", end: "2020-04-15" }
  "2020-21": { start: "2020-12-01", end: "2021-05-15" }
  "2021-22": { start: "2021-10-01", end: "2022-04-15" }
  "2022-23": { start: "2022-10-01", end: "2023-04-15" }
  "2023-24": { start: "2023-10-01", end: "2024-04-15" }
  "2024-25": { start: "2024-10-01", end: "2025-04-15" }
  "2025-26": { start: "2025-10-01", end: "2026-04-15" }

paths:
  raw: "data/raw"
  processed: "data/processed"
  # Portable default (works in both Windows and WSL). Override via env NBA_DB_PATH if needed.
  db: "data/processed/nba_build.duckdb"
  # Separate output root from outputs4/ to keep per-game artifacts isolated.
  outputs_player_game: "outputs_player_game"

build_db:
  skip_if_exists: true

repro:
  seed: 42

# Optional injuries: if enabled, next-game inference can suppress projections for players listed as OUT.
injury:
  data_path: "data/raw/injury_reports"
  enabled: false

# Player-game modeling settings (new namespace)
player_game:
  # Rolling windows to pull from `src/features/rolling.py` outputs
  rolling_windows: [10, 30]
  # Feature mixing: recent = alpha*L10 + (1-alpha)*L30
  recent_alpha: 0.7
  # Recency sample weighting: w = exp(-delta_days / half_life_days)
  half_life_days: 45
  # Head-to-head features (player vs opponent team)
  h2h_last_k: 5
  # Targets to train/predict (MVP defaults)
  targets: ["pts", "reb", "ast"]
  # Train/val/calibration split strategy
  split:
    # Fraction of latest games (by date) reserved for calibration intervals.
    calibration_frac: 0.15
    # Fraction of remaining training reserved for validation (for XGB early stopping).
    val_frac: 0.10
  # Interval calibration quantile (e.g. 0.8 ~ “± 80%” interval)
  interval_quantile: 0.80

  model_a:
    kind: "ridge"
    alpha: 1.0

  model_b:
    kind: "xgb"
    xgb:
      n_estimators: 500
      max_depth: 6
      learning_rate: 0.05
      subsample: 0.8
      colsample_bytree: 0.8
      early_stopping_rounds: 25

